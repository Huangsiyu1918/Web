<!DOCTYPE html>
<html>
  <head>
    <title>Prac 8</title>
    <meta content="">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css">
    <style>.button-success {background: rgb(28, 184, 65);color: white;}</style>
  </head>
  <body>
  
    <div id="main">
  
        <h1>My Blog</h1>
        <hr />
        <div id="newpost">
            <h2>Add a post</h2>
            <form class="pure-form">

                <fieldset class="pure-group">
                    <input type="text" id="title" class="pure-input-1-2" placeholder="Blog post title">
                    <textarea class="pure-input-1-2" id="text" placeholder="Blog Post Content"></textarea>
                </fieldset>

                <button type="button" onclick="send()" class="pure-button pure-input-1-2 pure-button-primary">make post</button>
            </form>
        </div>
        <script>

            function send() {
    
                var title = document.getElementById("title").value;
                var text = document.getElementById("text").value;
    
                var xhttp = new XMLHttpRequest();
                xhttp.open("POST", "/users/addpost", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(JSON.stringify({ title: title, text: text }));
    
            }
    
        </script>
    
        <hr />
        <div id="posts">
            <h2>Current Posts</h2>
            <form class="pure-form">
                <button type="button" onclick="show()" class="pure-button pure-input-1-2 pure-button-primary">show all posts</button>
            </form>
        
        </div>

        <div id = "post">

        </div>

        <script>

            function show() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        let arr = JSON.parse(this.response);
                        let innerTxt = document.getElementById("post");
                        innerTxt.innerHTML = ""; 
                        for(let i = 0; i < arr.length; i++)
                        {
                            innerTxt.innerHTML += "<div>" + "<h2>" + arr[i].title + "</h2>"
                                + "<p>" + arr[i].text + "</p>" + "<div>";
                        }
                    }
                };
                xhttp.open("GET", "/users/getposts", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }
    
        </script>
        
        <div id="tcs" style="display: none;">
            <h2>Terms and Conditions</h2>
            <p>All your base are belong to us.</p>
            <button class="pure-button button-success">Accept</button>
        </div>
    
    </div>
  
  </body>
</html>
